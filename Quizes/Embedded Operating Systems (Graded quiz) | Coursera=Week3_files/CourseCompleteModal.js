define("bundles/ondemand/components/endOfCourse/components/CourseCompleteModal",["require","exports","module","underscore","react","bundles/ssr/stores/ApplicationStore","bundles/ondemand/stores/CourseStore","bundles/ondemand/stores/CourseViewGradeStore","bundles/ondemand/stores/VerificationStore","bundles/ondemand/stores/S12nStore","bundles/ondemand/actions/VerificationActions","bundles/ondemand/actions/CourseViewGradeActions","bundles/ondemand/actions/S12nActions","bundles/phoenix/components/Modal","bundles/ondemand/components/endOfCourse/components/EndOfCourseHeader","bundles/ondemand/components/endOfCourse/components/KeepLearning","bundles/ondemand/utils/endOfCourseUtils","bundles/phoenix/lib/waitForStores","js/lib/provideFluxibleAppContext","js/lib/setupFluxibleApp","bundles/ondemand/models/S12n","pages/open-course/common/models/courseProgress","i18n!nls/ondemand","css!./__styles__/CourseCompleteModal"],function(require,exports,module){"use strict";function _defaults(e,r){for(var t=Object.getOwnPropertyNames(r),o=0;o<t.length;o++){var s=t[o],n=Object.getOwnPropertyDescriptor(r,s);n&&n.configurable&&void 0===e[s]&&Object.defineProperty(e,s,n)}return e}function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(o,e){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?o:e}function _inherits(o,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(o,e):_defaults(o,e))}var o,s,n,i=require("underscore"),u=i.compose,e=require("react"),a=require("bundles/ssr/stores/ApplicationStore"),c=require("bundles/ondemand/stores/CourseStore"),l=require("bundles/ondemand/stores/CourseViewGradeStore"),p=require("bundles/ondemand/stores/VerificationStore"),m=require("bundles/ondemand/stores/S12nStore"),f=require("bundles/ondemand/actions/VerificationActions"),d=f.loadVerificationDisplay,b=require("bundles/ondemand/actions/CourseViewGradeActions"),r=b.refreshCourseViewGrade,C=require("bundles/ondemand/actions/S12nActions"),h=C.loadS12n,S=require("bundles/phoenix/components/Modal"),g=require("bundles/ondemand/components/endOfCourse/components/EndOfCourseHeader"),y=require("bundles/ondemand/components/endOfCourse/components/KeepLearning"),t=require("bundles/ondemand/utils/endOfCourseUtils"),P=require("bundles/phoenix/lib/waitForStores"),w=require("js/lib/provideFluxibleAppContext"),O=require("js/lib/setupFluxibleApp"),x=require("bundles/ondemand/models/S12n"),A=require("pages/open-course/common/models/courseProgress"),I=require("i18n!nls/ondemand");require("css!./__styles__/CourseCompleteModal");var v=(s=o=function(o){function CourseCompleteModal(e,s){_classCallCheck(this,CourseCompleteModal);var t=_possibleConstructorReturn(this,o.call(this,e,s));n.call(t);var a=e.authenticated,l=e.course,i=e.courseId,u=e.userId,c=e.s12n,p=c&&c.getId(),m=l.isVerificationEnabled();return s.executeAction(d,{authenticated:a,userId:u,courseId:i,isCourseVerificationEnabled:m,s12nId:p}),s.executeAction(h,{authenticated:a,courseId:i,userId:u}),s.executeAction(r,{userId:u,courseId:i}),e.courseProgress&&e.courseProgress.on("refreshed",t.onCourseProgressRefresh),t}return _inherits(CourseCompleteModal,o),CourseCompleteModal.prototype.componentWillUnmount=function componentWillUnmount(){this.props.courseProgress&&this.props.courseProgress.off("refreshed",this.onCourseProgressRefresh)},CourseCompleteModal.prototype.shouldDisplayModal=function shouldDisplayModal(){var e=this.props,o=e.courseId,s=e.passedCourse;return s&&!t.hasDismissedCourseCompleteModal(o)&&!this.state.modalClosed},CourseCompleteModal.prototype.render=function render(){return this.shouldDisplayModal()?e.createElement(S,{modalName:I("Course complete"),className:"rc-CourseCompleteModal theme-light",handleClose:this.closeModal,trackingName:"course_complete_modal",allowClose:!0},e.createElement(g,{showPartner:!0}),e.createElement("div",{className:"content"},e.createElement(y,{showS12nProgress:!0}))):null},CourseCompleteModal}(e.Component),o.propTypes={passedCourse:e.PropTypes.bool,courseProgress:e.PropTypes.instanceOf(A),courseId:e.PropTypes.string,userId:e.PropTypes.number,authenticated:e.PropTypes.bool,course:e.PropTypes.object,s12n:e.PropTypes.instanceOf(x)},o.contextTypes={executeAction:e.PropTypes.func.isRequired},n=function _initialiseProps(){var e=this;this.state={modalClosed:!1},this.onCourseProgressRefresh=function(){var o=e.props.courseId;e.context.executeAction(r,{courseId:o})},this.closeModal=function(){e.setState({modalClosed:!0}),t.dismissCourseCompleteModal(e.props.courseId)}},s);module.exports=u(w(function(e){return O(e,function(o){return o.registerStore(a),o.registerStore(c),o.registerStore(l),o.registerStore(p),o.registerStore(m),e})}),P(["ApplicationStore","CourseStore","CourseViewGradeStore","S12nStore"],function(e,t){var o=e.ApplicationStore,s=e.CourseStore,n=e.CourseViewGradeStore,r=e.S12nStore;return{userId:o.getUserData().id,courseId:s.getCourseId(),course:s.getMetadata(),s12n:r.getS12n(),authenticated:o.isAuthenticatedUser(),passedCourse:!!n.hasPassedCourseUnverified()}}))(v)});