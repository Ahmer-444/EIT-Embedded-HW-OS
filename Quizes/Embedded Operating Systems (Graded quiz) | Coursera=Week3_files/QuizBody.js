define("bundles/quiz/components/QuizBody",["require","exports","module","react","js/components/Imgix","bundles/content-feedback/components/ItemFeedback","bundles/content-feedback/constants/ItemTypes","bundles/quiz-formative/components/FormativeQuizHeader","bundles/quiz-summative/components/SummativeQuizHeader","bundles/quiz-common/components/SubmitArea","bundles/quiz/components/QuizQuestions","bundles/quiz/components/UnansweredQuestionsLabel","bundles/quiz-question-types/models/AbstractCheckboxQuestion","bundles/quiz-question-types/models/AbstractQuestion","bundles/quiz-common/models/GradingAttempt","pages/open-course/common/models/itemMetadata","bundles/quiz-common/actions/QuizActions","bundles/quiz-common/utils/FsmUtils","pages/open-course/common/constants","i18n!nls/quiz"],function(require,exports,module){"use strict";function _defaults(e,o){for(var i=Object.getOwnPropertyNames(o),t=0;t<i.length;t++){var n=i[t],s=Object.getOwnPropertyDescriptor(o,n);s&&s.configurable&&void 0===e[n]&&Object.defineProperty(e,n,s)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var n,o,i,e=require("react"),r=require("js/components/Imgix"),c=require("bundles/content-feedback/components/ItemFeedback"),u=require("bundles/content-feedback/constants/ItemTypes"),m=require("bundles/quiz-formative/components/FormativeQuizHeader"),l=require("bundles/quiz-summative/components/SummativeQuizHeader"),d=require("bundles/quiz-common/components/SubmitArea"),a=require("bundles/quiz/components/QuizQuestions"),p=require("bundles/quiz/components/UnansweredQuestionsLabel"),b=require("bundles/quiz-question-types/models/AbstractCheckboxQuestion"),f=require("bundles/quiz-question-types/models/AbstractQuestion"),g=require("bundles/quiz-common/models/GradingAttempt"),y=require("pages/open-course/common/models/itemMetadata"),q=require("bundles/quiz-common/actions/QuizActions"),h=q.submitQuiz,z=require("bundles/quiz-common/utils/FsmUtils"),t=z.isState,v=require("pages/open-course/common/constants"),w=v.assets,s=require("i18n!nls/quiz"),E=(o=n=function(n){function QuizBody(s){_classCallCheck(this,QuizBody);var e=_possibleConstructorReturn(this,n.call(this,s));i.call(e);var t={};return e.props.questions.forEach(function(e){e instanceof b&&(t[e.id]=e.createEmptyAnswer())}),e.state={answers:t},e}return _inherits(QuizBody,n),QuizBody.prototype.getHeaderComponent=function getHeaderComponent(){var t=this.props.itemMetadata,e=t.getTypeName();switch(e){case"quiz":return m;case"exam":return l;default:throw new Error("Unknown quiz type: "+e)}},QuizBody.prototype.render=function render(){var n=this.props,i=n.itemMetadata,m=n.questions,y=n.sessionData,o=n.attemptState,f=n.gradingAttempt,g=n.courseMaterials,b=n.verificationDisplay,q=n.assessmentClient,h=n.onClose,z=this.state.answers,v=y.evaluation,E=this.getHeaderComponent(),l=m.length-Object.keys(z).length,Q=l>0;return e.createElement("div",{className:"rc-QuizBody c-open-single-page-attempt appear-inward-effect"},e.createElement("div",{className:"c-open-single-page-header-container bt3-container-fluid"},e.createElement("button",{className:"c-close-icon",onClick:h},e.createElement("span",{className:"c-hidden-accessibility"},s("Close")),e.createElement("i",{className:"cif-times"})),e.createElement(E,{itemMetadata:i,questions:m,evaluation:v,attemptState:o,gradingAttempt:f,onSubmit:this.handleSubmit,verificationDisplay:b,assessmentClient:q,nextItemMetadata:g.getNeighboringItemMetadata(i).next})),e.createElement("div",{className:"bt3-row c-open-single-page-body-container"},e.createElement("div",{className:"bt3-col-md-12"},t(o,"loading")&&e.createElement("div",null,e.createElement("span",null,s("Loading..."),"  "),e.createElement(r,{src:w.rootPath+"images/icons/loading.gif",alt:""})),t(o,"load-error")&&e.createElement("div",null,s("Load Error!")),!t(o,"nothing","loading","load-error")&&e.createElement(a,{attemptState:o,questions:m,onAnswer:this.handleAnswer})),!t(o,"nothing","loading","load-error","submitted")&&e.createElement("div",null,e.createElement("div",{className:"bt3-col-md-9"}),e.createElement("div",{className:"bt3-col-md-3"},Q&&e.createElement(p,{unansweredQuestionCount:l}),e.createElement(d,{itemMetadata:i,attemptState:o,onSubmit:this.handleSubmit}))),!t(o,"nothing","loading","load-error")&&e.createElement("div",{className:"c-quiz-item-feedback"},e.createElement(c,{itemType:u.Quiz,itemMetadata:i,itemId:i.get("id"),courseId:i.get("course").get("id")}))))},QuizBody}(e.Component),n.propTypes={itemMetadata:e.PropTypes.instanceOf(y).isRequired,questions:e.PropTypes.arrayOf(e.PropTypes.instanceOf(f)).isRequired,attemptState:e.PropTypes.string.isRequired,courseMaterials:e.PropTypes.object.isRequired,verificationDisplay:e.PropTypes.object.isRequired,assessmentClient:e.PropTypes.object.isRequired,onClose:e.PropTypes.func.isRequired,gradingAttempt:e.PropTypes.instanceOf(g),sessionId:e.PropTypes.string.isRequired,sessionData:e.PropTypes.object.isRequired},n.contextTypes={executeAction:e.PropTypes.func.isRequired},i=function _initialiseProps(){var e=this;this.handleAnswer=function(n,s){var t=Object.assign({},e.state.answers);s?t[n.id]=s:delete t[n.id],e.setState({answers:t})},this.handleSubmit=function(){var t=e.props,o=t.sessionData,i=t.assessmentClient,a=t.sessionId,s=o.questions,n=Object.assign({},e.state.answers);s.forEach(function(e){n[e.id]=n[e.id]||e.createEmptyAnswer()}),e.context.executeAction(h,{answers:n,sessionId:a,questions:s,client:i})}},o);module.exports=E});