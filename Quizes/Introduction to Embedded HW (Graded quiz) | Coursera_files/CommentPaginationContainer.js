define("bundles/discussions/components/repliesList/CommentPaginationContainer",["require","exports","module","react","bundles/discussions/components/ListBody","bundles/discussions/components/repliesList/ReplyComponent","vendor/cnpm/fluxible.v0-4/addons/connectToStores","bundles/discussions/constants","bundles/discussions/actions/ThreadDetailsActions","bundles/discussions/lib/propTypes","i18n!nls/discussions"],function(require,exports,module){"use strict";function _defaults(e,s){for(var r=Object.getOwnPropertyNames(s),t=0;t<r.length;t++){var n=r[t],o=Object.getOwnPropertyDescriptor(s,n);o&&o.configurable&&void 0===e[n]&&Object.defineProperty(e,n,o)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var n,o,e=require("react"),i=require("bundles/discussions/components/ListBody"),a=require("bundles/discussions/components/repliesList/ReplyComponent"),r=require("vendor/cnpm/fluxible.v0-4/addons/connectToStores"),c=require("bundles/discussions/constants"),t=c.loadingStates,p=require("bundles/discussions/actions/ThreadDetailsActions"),s=p.fetchMultipleCommentPages,d=require("bundles/discussions/lib/propTypes"),l=d.replyPropType,u=require("i18n!nls/discussions"),m=(o=n=function(n){function CommentPaginationContainer(){var o,e,r;_classCallCheck(this,CommentPaginationContainer);for(var i=arguments.length,a=Array(i),t=0;i>t;t++)a[t]=arguments[t];return o=e=_possibleConstructorReturn(this,n.call.apply(n,[this].concat(a))),e.state={loadingComments:!1},e.loadEarlierReplies=function(){var t=e.props,n=t.reply,r=t.commentPageRange,i=t.forumType,a=t.includeDeleted,o=r.endPage,c=n.questionId;e.context.executeAction(s,{questionId:c,forumType:i,includeDeleted:a,answerId:n.topLevelForumAnswerId,userForumAnswerId:n.id,startPage:o+1,endPage:o+1}),e.setState({loadingComments:!0})},r=o,_possibleConstructorReturn(e,r)}return _inherits(CommentPaginationContainer,n),CommentPaginationContainer.prototype.componentWillMount=function componentWillMount(){var e=this.props,t=e.reply,n=e.answerId,o=e.commentId,r=e.forumType,i=e.includeDeleted;if(o&&t.topLevelForumAnswerId===n){var a=t.questionId;this.context.executeAction(s,{questionId:a,answerId:n,userForumAnswerId:t.id,startPage:1,endPage:100,forumType:r,includeDeleted:i})}},CommentPaginationContainer.prototype.componentWillReceiveProps=function componentWillReceiveProps(e){this.props.commentLoadingState===t.LOADING&&this.props.commentLoadingState!==e.commentLoadingState&&this.setState({loadingComments:!1})},CommentPaginationContainer.prototype.render=function render(){var c=this,n=this.props,y=n.reply,r=n.comments,s=n.commentLoadingState,d=n.answerId,l=n.commentId,p=n.commentPageRange,o=this.state.loadingComments||s===t.LOADING,m=o?t.DONE:s;if(0===y.childAnswerCount)return null;return e.createElement("div",{className:"rc-CommentPaginationContainer vertical-box"},p.endPage<p.totalPageCount&&e.createElement("button",{className:"secondary reply-load-button",onClick:this.loadEarlierReplies,disabled:o},o?e.createElement("span",{className:"cif-spinner cif-spin"}):u("See earlier replies")),e.createElement(i,{loadingState:m},r&&r.map(function(t,n){return e.createElement(a,{reply:t,key:t.id+n,answerId:d,commentId:l,commentsEnabled:!1,ref:t.id,isQuestionLoaded:c.props.isQuestionLoaded,forumLink:c.props.forumLink})})))},CommentPaginationContainer}(e.Component),n.propTypes={reply:l.isRequired,answerId:e.PropTypes.string,commentId:e.PropTypes.string,commentLoadingState:e.PropTypes.string,comments:e.PropTypes.array,commentPageRange:e.PropTypes.object,isQuestionLoaded:e.PropTypes.bool,forumLink:e.PropTypes.string,forumType:e.PropTypes.string,includeDeleted:e.PropTypes.bool},n.contextTypes={executeAction:e.PropTypes.func.isRequired},o);module.exports=r(m,["ThreadDetailsStore","ApplicationStore","CourseMembershipStore"],function(n,s){var e=n.ThreadDetailsStore,r=n.ApplicationStore,i=n.CourseMembershipStore,o=s.reply;return{comments:e.getLoadedComments(o.topLevelForumAnswerId),commentLoadingState:e.commentLoadingState[o.topLevelForumAnswerId]||t.LOADING,commentPageRange:e.getCommentPageRange(o.topLevelForumAnswerId),forumType:e.forumType,includeDeleted:i.hasModerationRole()||r.isSuperuser()}})});