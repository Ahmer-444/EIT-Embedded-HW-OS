define("bundles/classmates/components/MiniProfile",["require","exports","module","underscore","react","classnames","bundles/classmates/actions/ClassmatesProfileActions","bundles/classmates/components/ProfileImageWithRole","bundles/classmates/utils/lib","bundles/classmates/stores/ClassmatesProfileStore","bundles/iconfont/Icon","js/lib/provideFluxibleAppContext","js/lib/setupFluxibleApp","js/lib/coursera.react-intl","vendor/cnpm/fluxible.v0-4/addons/connectToStores","i18n!nls/classmates","css!./__styles__/MiniProfile.css"],function(require,exports,module){"use strict";function _defaults(e,r){for(var n=Object.getOwnPropertyNames(r),t=0;t<n.length;t++){var s=n[t],o=Object.getOwnPropertyDescriptor(r,s);o&&o.configurable&&void 0===e[s]&&Object.defineProperty(e,s,o)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var t,o,_=require("underscore"),e=require("react"),r=require("classnames"),y=require("bundles/classmates/actions/ClassmatesProfileActions"),l=y.getClassmatesProfile,c=require("bundles/classmates/components/ProfileImageWithRole"),s=require("bundles/classmates/utils/lib"),a=s.getProgressString,p=s.getCourseRoleString,u=s.hasModeratorAccess,f=require("bundles/classmates/stores/ClassmatesProfileStore"),m=require("bundles/iconfont/Icon"),d=require("js/lib/provideFluxibleAppContext"),b=require("js/lib/setupFluxibleApp"),h=require("js/lib/coursera.react-intl"),n=h.FormattedMessage,g=require("vendor/cnpm/fluxible.v0-4/addons/connectToStores"),i=require("i18n!nls/classmates");require("css!./__styles__/MiniProfile.css");var v=(o=t=function(t){function MiniProfile(){var o,s,r;_classCallCheck(this,MiniProfile);for(var n=arguments.length,i=Array(n),e=0;n>e;e++)i[e]=arguments[e];return o=s=_possibleConstructorReturn(this,t.call.apply(t,[this].concat(i))),s.state={transitionContainer:!1},r=o,_possibleConstructorReturn(s,r)}return _inherits(MiniProfile,t),MiniProfile.prototype.componentWillMount=function componentWillMount(){(!this.props.profile||_(this.props.profile).isEmpty())&&this.context.executeAction(l,{externalId:this.props.externalId,courseId:this.props.courseId})},MiniProfile.prototype.componentDidMount=function componentDidMount(){var e=this;this.transitionTimeout=setTimeout(function(){e.setState({transitionContainer:!0})},100)},MiniProfile.prototype.componentWillUnmount=function componentWillUnmount(){this.transitionTimeout&&clearTimeout(this.transitionTimeout)},MiniProfile.prototype.hasLoaded=function hasLoaded(){return this.props.profile&&!_(this.props.profile).isEmpty()},MiniProfile.prototype.renderCourseProgress=function renderCourseProgress(){var e=this.props.profile,t=this.props.courseRole||e.courseRole;if(u(t))return p(t);return a(e.courseProgressPercentage)},MiniProfile.prototype.renderMiniProfile=function renderMiniProfile(){var t=this.props.profile,s=this.props.courseRole||t.courseRole,o=r("profile-footer","caption-text","color-secondary-text","bgcolor-black-g1","horizontal-box","align-items-absolute-center");return e.createElement("div",{className:"vertical-box"},e.createElement("div",{className:"vertical-box profile-header align-items-vertical-center"},e.createElement("div",{className:"profile-photo"},e.createElement(c,{courseRole:s,fullName:t.fullName,profileImageUrl:t.photoUrl||""})),e.createElement("div",{className:"body-1-text"},t.fullName),e.createElement("div",{className:"caption-text color-secondary-text"},this.renderCourseProgress())),e.createElement("div",{className:o},e.createElement(n,{message:i("{postsCount} {postsCount, plural, =1 { post} other { posts}}"),postsCount:t.postsCount||"0"}),e.createElement("span",{className:"dot-spacing"}," Â· "),e.createElement(n,{message:i("{upvotes} {upvotes, plural, =1 { upvote} other { upvotes}}"),upvotes:t.votesReceivedCount||"0"})))},MiniProfile.prototype.renderLoading=function renderLoading(){return e.createElement("div",{className:"loading-state"},e.createElement(m,{name:"spinner",size:"3x",spin:!0}))},MiniProfile.prototype.render=function render(){var t=r("rc-MiniProfile","card-one-clicker",this.props.orientationClass,{"transition-in":this.state.transitionContainer});return e.createElement("div",{className:t},this.hasLoaded()?this.renderMiniProfile():this.renderLoading())},MiniProfile}(e.Component),t.propTypes={externalId:e.PropTypes.string.isRequired,courseId:e.PropTypes.string,courseRole:e.PropTypes.string,orientationClass:e.PropTypes.string.isRequired,profile:e.PropTypes.object},t.contextTypes={executeAction:e.PropTypes.func.isRequired},o);module.exports=_.compose(d(function(e){return b(e,function(t){return t.registerStore(f),e})}),g(["CourseStore","ClassmatesProfileStore"],function(e,t){var s=e.CourseStore,o=e.ClassmatesProfileStore,r=t.externalId;return{courseId:s.getCourseId(),profile:_(o.profiles).findWhere({externalId:r})}}))(v)});