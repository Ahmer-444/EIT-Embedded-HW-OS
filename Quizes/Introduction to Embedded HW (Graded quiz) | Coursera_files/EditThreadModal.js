define("bundles/discussions/components/EditThreadModal",["require","exports","module","underscore","i18n!nls/discussions","react","react-dom","bundles/phoenix/components/Modal","bundles/cml/utils/CMLUtils","bundles/discussions/utils/DiscussionsCMLUtils","bundles/discussions/components/ModerationReasons","bundles/discussions/components/NotifyOption","bundles/discussions/constants","bundles/discussions/actions/DropdownActions","bundles/discussions/components/NewThreadFormComponents","css!./__styles__/NewThreadButton"],function(require,exports,module){"use strict";function _defaults(e,o){for(var a=Object.getOwnPropertyNames(o),t=0;t<a.length;t++){var s=a[t],n=Object.getOwnPropertyDescriptor(o,s);n&&n.configurable&&void 0===e[s]&&Object.defineProperty(e,s,n)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var s,n,_=require("underscore"),t=require("i18n!nls/discussions"),e=require("react"),i=require("react-dom"),l=require("bundles/phoenix/components/Modal"),r=require("bundles/cml/utils/CMLUtils"),c=require("bundles/discussions/utils/DiscussionsCMLUtils"),d=require("bundles/discussions/components/ModerationReasons"),u=require("bundles/discussions/components/NotifyOption"),o=require("bundles/discussions/constants"),h=require("bundles/discussions/actions/DropdownActions"),p=h.editThread,a=require("bundles/discussions/components/NewThreadFormComponents"),m=a.TitleInput,f=a.ContentInput;require("css!./__styles__/NewThreadButton");var E=(n=s=function(s){function EditThreadModal(l,c){_classCallCheck(this,EditThreadModal);var e=_possibleConstructorReturn(this,s.call(this,l,c));e.handleSuccess=function(){e.closeModal()},e.handleSubmit=function(){var t=_(e.state).any(function(e){return e.hasError});t?(e.state.title.hasError?e.refs.title.refs.title.focus():e.state.content.hasError&&i.findDOMNode(e.refs.content.refs.content.refs.editorWrapper.refs.editor).focus(),e.setState({showErrors:!0})):(e.setState({saving:!0}),e.context.executeAction(p,{id:e.props.question.id,questionId:e.props.question.questionId,forumType:e.props.question.forumType,question:e.state.title.value,details:e.state.content.value,handleSuccess:e.handleSuccess,handleFailure:e.handleSaveError,reason:e.state.selectedOption,dontNotify:e.state.dontNotify}))},e.handleInputChange=function(t,s){e.state[t].value=s.value,e.state[t].hasError=!s.isValid,e.setState(e.state)},e.handleSaveError=function(s){e.setState({saveError:!0,saveErrorMessage:t("Something went wrong. Please reload the page and try again."),saving:!1})},e.handleSelect=function(t){e.setState({selectedOption:t.target.value})},e.handleReasonsSubmit=function(){e.state.selectedOption?e.setState({showModerationReasons:!1}):e.setState({showInputError:!0})},e.handleReasonsCancel=function(){e.closeModal()},e.handleCloseModal=function(){e.closeModal()},e.handleCancel=function(){e.closeModal()},e.toggleNotify=function(){e.setState({dontNotify:!e.state.dontNotify})};var n=l.question.content,a=n.details;if(!n.details||!n.details.typeName){var d="<co-content><text>"+(n.details||"")+"</text></co-content>";a=r.create(d,o.DTD_NAME)}return a.definition.dtdId=o.DTD_NAME,e.state={title:{value:n.question||"",hasError:!1},content:{value:a,hasError:!1},showErrors:!1,saving:!1,saveError:!1,saveErrorMessage:"",showModerationReasons:!1,selectedOption:"",showInputError:!1,dontNotify:!1},e}return _inherits(EditThreadModal,s),EditThreadModal.prototype.componentWillMount=function componentWillMount(){this.setState({showModerationReasons:this.props.showReasons})},EditThreadModal.prototype.closeModal=function closeModal(){this.props.handleClose()},EditThreadModal.prototype.render=function render(){var n=c.generateContentLengthWarning(this.state.content.value),o=e.createElement("div",{className:"c-error-text c-form-error-message"},this.state.saveErrorMessage),a=e.createElement("div",{className:"c-error-text c-modal-error-message"},t("Please select a reason")),s=void 0;s=this.state.showModerationReasons?e.createElement("div",null,e.createElement("div",{className:"c-modal-subtitle"},e.createElement("span",null,t("Why do you want to edit this? "))),e.createElement(d,{ref:"reasons",handleSelect:this.handleSelect}),e.createElement(u,{dontNotify:this.state.dontNotify,toggleNotify:this.toggleNotify}),e.createElement("div",null,this.state.showInputError&&a,e.createElement("div",{className:"horizontal-box align-items-right"},e.createElement("button",{ref:"cancel",className:"passive",onClick:this.handleReasonsCancel},t("Cancel")),"  ",e.createElement("button",{ref:"submit",disabled:this.state.saving,className:"secondary",type:"submit",onClick:this.handleReasonsSubmit},t("Edit Post"))))):e.createElement("div",null,e.createElement("div",{className:"c-input-area"},e.createElement("label",{className:"c-form-label-area"},e.createElement("h2",{className:"c-form-label headline-1-text"},t("Title"))),e.createElement(m,{ref:"title",hasError:this.state.showErrors&&this.state.title.hasError,value:this.state.title.value,handleInputChange:this.handleInputChange})),e.createElement("div",{className:"c-input-area"},e.createElement("label",{className:"c-form-label-area"},e.createElement("h2",{className:"c-form-label headline-1-text"},t("Body"))),e.createElement(f,{ref:"content",courseId:this.props.courseId,hasError:this.state.showErrors&&this.state.content.hasError,handleInputChange:this.handleInputChange,cml:this.state.content.value})),e.createElement("div",null,n,this.state.saveError&&o,e.createElement("div",{className:"horizontal-box align-items-right"},e.createElement("button",{className:"passive",onClick:this.handleCancel},t("Cancel")),"  ",e.createElement("button",{ref:"submit",disabled:this.state.saving,className:"secondary",type:"submit",onClick:this.handleSubmit},t("Submit")))));var r=e.createElement(l,{ref:"editThreadModal",modalName:t("Edit thread"),handleClose:this.handleCloseModal},e.createElement("h1",{className:"c-modal-title display-1-text"},t("Edit thread")),s);return e.createElement("div",{className:"rc-EditThreadForm"},r)},EditThreadModal}(e.Component),s.propTypes={courseId:e.PropTypes.string,question:e.PropTypes.object.isRequired,handleClose:e.PropTypes.func.isRequired,showReasons:e.PropTypes.bool},s.contextTypes={executeAction:e.PropTypes.func.isRequired},n);module.exports=E});