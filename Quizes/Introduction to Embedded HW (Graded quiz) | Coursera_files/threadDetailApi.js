define("bundles/discussions/api/threadDetailApi",["require","exports","module","bundles/discussions/api/forumApiChoiceUtil","jsuri","bundles/discussions/constants","bundles/discussions/constants"],function(require,exports,module){"use strict";var m=require("bundles/discussions/api/forumApiChoiceUtil"),p=m.getQuestionApi,t=m.getAnswerApi,n=require("jsuri"),Q=require("bundles/discussions/constants"),w=Q.defaults,i=require("bundles/discussions/constants"),e=i.naptimeForumTypes,P=i.answerSorts,d=i.comments.limitPerPage,r=function getAnswerApiName(r){if(r===e.mentorForumType)return"onDemandMentorForumAnswers.v1";if(r===e.groupForumType)return"onDemandGroupForumAnswers.v1";return"onDemandCourseForumAnswers.v1"},l=function getAnswerParams(t,r,n,o){if(t===e.mentorForumType)return{userMentorForumQuestionId:[r,n,o].join("~")};if(t===e.groupForumType)return{userGroupForumQuestionId:[r,n,o].join("~")};return{userCourseQuestionId:[r,n,o].join("~")}},c=function getByParentAnswerParams(n,r){if(n===e.mentorForumType)return{userMentorForumAnswerId:r};if(n===e.groupForumType)return{userGroupForumAnswerId:r};return{userCourseForumAnswerId:r}},f=["profiles"],o=["profiles","children"],y=function getQuestionIncludesWithAnswers(e){return["posts",e+"("+o.join(",")+")"]},g=["content","state","creatorId","createdAt","forumId","sessionId","lastAnsweredBy","lastAnsweredAt","upvoteCount","followCount","totalAnswerCount","topLevelAnswerCount","viewCount","isFlagged","isFollowing","isUpvoted","answerBadge","forumAnswerBadgeTagMap"],a=["userId","externalUserId","fullName","photoUrl","courseRole"],s=["content","forumQuestionId","parentForumAnswerId","state","creatorId","createdAt","order","upvoteCount","childAnswerCount","isFlagged","isUpvoted"],u=function getAllAnswerFields(e){return[s.join(","),"onDemandSocialProfiles.v1("+a.join(",")+")",e+"("+s.join(",")+")"]},A=function getAllQuestionFields(e){return[g.join(","),"onDemandSocialProfiles.v1("+a.join(",")+")",e+"("+s.join(",")+")"]};exports.getQuestion=function(e){var u=e.questionId,s=e.userId,i=e.contextId,o=e.forumType,a=e.sort,d=e.page,t=f.slice();1===d&&a===w.detailSort&&(t=t.concat(y(r(o))));var m=new n([s,i,u].join("~")).addQueryParam("includes",t.join(",")).addQueryParam("fields",A(r(o)).join(","));return p(o).get(m.toString())},exports.getAnswersWithComments=function(e){var f=e.questionId,P=e.userId,p=e.contextId,i=e.forumType,m=e.sort,c=e.page,a=e.limit,y=e.includeDeleted,g=a||15,s=(new n).addQueryParam("q","byForumQuestionId").addQueryParam("includeDeleted",y?"true":"false").addQueryParam("fields",u(r(i)).join(",")).addQueryParam("includes",o.join(",")).addQueryParam("limit",g),d=l(i,P,p,f);return Object.keys(d).forEach(function(e){s.addQueryParam(e,d[e])}),m&&s.addQueryParam("sort",m),c-1>0&&s.addQueryParam("start",(c-1)*a),t(i).get(s.toString())},exports.getComments=function(e){var l=e.userForumAnswerId,s=e.forumType,f=e.includeDeleted,i=e.startPage,p=e.endPage,a=(new n).addQueryParam("q","byParentForumAnswerId").addQueryParam("includeDeleted",f?"true":"false").addQueryParam("fields",u(r(s)).join(",")).addQueryParam("includes",o.join(",")).addQueryParam("sort",P.newestSort).addQueryParam("limit",(p-i+1)*d);i&&a.addQueryParam("start",(i-1)*d);var m=c(s,l);return Object.keys(m).forEach(function(e){a.addQueryParam(e,m[e])}),t(s).get(a.toString())},exports.savePost=function(s,e){var i=(new n).addQueryParam("fields",u(r(e)).join(",")).addQueryParam("includes",o.join(","));return t(e).post(i.toString(),s)}});