define("bundles/discussions/actions/ThreadDetailsActions",["require","exports","module","bundles/discussions/actions/ThreadSettingsActions","bundles/discussions/api/upvoteApi","bundles/discussions/api/followApi","bundles/discussions/api/threadDetailApi","bundles/discussions/constants","bundles/discussions/utils/unreadTracker"],function(require,exports,module){"use strict";var f=require("bundles/discussions/actions/ThreadSettingsActions"),a=f.addThread,o=require("bundles/discussions/api/upvoteApi"),h=o.upvote,r=o.cancelUpvote,u=require("bundles/discussions/api/followApi"),T=u.follow,I=u.unfollow,t=require("bundles/discussions/api/threadDetailApi"),d=t.getQuestion,c=t.getAnswersWithComments,p=t.getComments,l=t.savePost,s=require("bundles/discussions/constants"),n=require("bundles/discussions/utils/unreadTracker"),i=s.savingStates,e=s.loadingStates,A=s.answers.limitPerPage;exports.fetchThread=function(s,i){var t=i.questionId,r=i.contextId,u=i.userId,o=i.forumType,c=i.sort,p=i.page,l=s.getStore("ThreadDetailsStore").getQuestion(t)&&s.getStore("ThreadDetailsStore").getQuestion(t),f=s.getStore("ThreadsStore").getThreadsPage(),T=f.find(function(e){return e.questionId===t});!l||n.hasUnread(T)?!function(){var i=function setLoadingState(e){s.dispatch("QUESTION_LOADING_STATE",{questionId:t,loadingState:e})};i(e.LOADING),s.dispatch("UNSET_QUESTION",{questionId:t}),d({questionId:t,userId:u,contextId:r,forumType:o,sort:c,page:p}).then(function(u){s.dispatch("LOAD_QUESTION",{response:u,questionId:t,forumType:o}),i(e.DONE),s.executeAction(a,Object.assign(u.elements[0],{forumType:o})),n.markRead(t)}).fail(function(t){return i(e.ERROR)}).done()}():(s.executeAction(a,s.getStore("ThreadDetailsStore").getQuestion(t)),n.markRead(t))};var O=function fetchCommentPagesHelper(n,t){var o=t.questionId,s=t.answerId,u=t.userForumAnswerId,a=t.forumType,d=t.includeDeleted,i=t.startPage,r=t.endPage;return p({userForumAnswerId:u,forumType:a,includeDeleted:d,startPage:i,endPage:r}).then(function(e){return n.dispatch("LOAD_COMMENT_PAGES",{response:e,answerId:s,startPage:i,questionId:o})}).fail(function(t){n.dispatch("COMMENT_LOADING_STATE",{answerId:s,loadingState:e.ERROR})})};exports.fetchMultipleCommentPages=function(n,t){var i=t.questionId,s=t.answerId,o=t.userForumAnswerId,u=t.forumType,a=t.includeDeleted,d=t.startPage,r=t.endPage;n.dispatch("COMMENT_LOADING_STATE",{answerId:s,loadingState:e.LOADING}),n.executeAction(O,{questionId:i,answerId:s,userForumAnswerId:o,forumType:u,includeDeleted:a,startPage:d,endPage:r})},exports.fetchAnswers=function(o,t){var n=t.questionId,d=t.userId,r=t.contextId,s=t.sort,i=t.page,u=t.forumType,p=t.includeDeleted,a=function setLoadingState(e){o.dispatch("ANSWER_LOADING_STATE",{questionId:n,sort:s,page:i,loadingState:e})};a(e.LOADING),c({questionId:n,userId:d,contextId:r,forumType:u,sort:s,page:i,limit:A,includeDeleted:p}).then(function(e){o.dispatch("LOAD_ANSWERS_WITH_COMMENTS",{response:e,questionId:n,page:i,sort:s,forumType:u})}).fail(function(t){return a(e.ERROR)}).done()},exports.savePost=function(e,t){var u=t.options,o=t.question,a=t.forumType,s=t.parentPost,d=t.isFollowing;e.dispatch("SET_SAVING_STATE",{savingState:i.SAVING,id:s.id}),o&&(d?e.dispatch("FOLLOW",{question:o}):e.dispatch("UNFOLLOW",{question:o})),l(u,a).then(function(t){n.markRead(s.questionId),e.dispatch("RECEIVE_POST",{resp:t,data:u.data,parentPost:s,forumType:a}),e.dispatch("SET_SAVING_STATE",{savingState:i.SAVED,id:s.id})}).fail(function(t){return e.dispatch("SET_SAVING_STATE",{savingState:i.ERROR,id:s.id})}).done()},exports.upvote=function(t,n){var e=n.post;h(e).then(function(n){return t.dispatch("UPVOTE",{post:e})}).fail(function(n){return t.dispatch("UPVOTE_ERROR",{post:e})}).done()},exports.cancelUpvote=function(t,n){var e=n.post;r(e).then(function(n){return t.dispatch("CANCEL_UPVOTE",{post:e})}).fail(function(n){return t.dispatch("UPVOTE_ERROR",{post:e})}).done()},exports.follow=function(t,n){var e=n.question;T(e).then(function(n){return t.dispatch("FOLLOW",{question:e})}).fail(function(n){return t.dispatch("FOLLOW_ERROR",{question:e})}).done()},exports.unfollow=function(t,n){var e=n.question;I(e).then(function(n){return t.dispatch("UNFOLLOW",{question:e})}).fail(function(n){return t.dispatch("FOLLOW_ERROR",{question:e})}).done()}});